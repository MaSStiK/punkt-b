<script>
    // Перекидываем на конец теста если есть значение
    if (localStorage.getItem("test-end")) {
        location.href = "../testing-end"
    }
</script>

<script>
    // Если нету manager-id В ссылке то перекинет на страницу с просьбой получить актуальную ссылку
    let URLParams = Object.fromEntries(new URLSearchParams(window.location.search))
    // Если в строке нету значения manager-id или он не цифра или значение пустое
    if (!URLParams.hasOwnProperty("manager-id") || isNaN(URLParams["manager-id"]) || URLParams["manager-id"] === "") {
        location.href = "../testing-end?no-manager-id=true"
    }

    // Получем сохраненные данные о тестировании
    let questionsHash = JSON.parse(localStorage.getItem("questionsHash"))
    let isQuestionsHash = questionsHash ? true : false // Была ли информация взята из кеша

    // Если информации есть - то записываем
    if (isQuestionsHash) {
        questions = questionsHash
    }
</script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap');

    :root {
        --p-gray: #00000088;
        --p-cian: #66CAA5;
        --h-title: #BD92CE;

        --border: #BD92CE;
        --button: #BD92CE;
        --input-bg: #DEC8E7;
        --input-placeholder: #5E4967;

        --dot-bg: #F1CD21;
    }
    
    body {
        width: 100%;
    }
    
    h2 {
        font-family: 'Roboto', Sans-Serif;
        font-weight: 500;
        font-size: 48px;
        line-height: 134%;
    }
    
    h3 {
        font-family: 'Roboto', Sans-Serif;
        font-weight: 500;
        font-size: 24px;
        line-height: 132%;
    }
    
    p, .p1 {
        font-family: 'Roboto', Sans-Serif;
        font-weight: 400;
        font-size: 20px; /* На этой странице 20 вместо 18 */
        line-height: 21px;
    }

    .p1-strong {
        font-family: 'Roboto';
        font-weight: 500;
        font-size: 18px;
        line-height: 112%;
    }

    .p-gray {
        color: var(--p-gray);
    }

    .p-cut {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .hidden {
        display: none !important;
    }


    /* Стиль для ошибки инпута */
    input.error {
        animation: inputError 2s ease-in;
    }

    /* Анимацция ошибки */
    @keyframes inputError {
        0% {
            border: 1px solid var(--border);
        }

        2% {
            border: 1px solid #F40B0B;
        }

        100% {
            border: 1px solid var(--border);
        }
    }
</style>

<style>
    /* Логотип сверху слево */
    #top-left-logo {
        width: 128px;
        
        position: absolute;
        top: 50px;
        left: 100px;
        
    }
    
    #top-left-logo img {
        width: 100%;
    }
</style>
    
<style>
    article {
        width: min(1440px, 100%); /* Ширина 1440px или 100% при сужении */
        height: 800px;
        display: flex;
        flex-direction: row;
        justify-content: center;
        position: relative;
        
        margin: 0 auto; /* По центру страницы */
    }
    
    
    #form-aside {
        width: 50%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-end;
        gap: 12px;
    }


    #form-aside h3 {
        width: 403px;
        height: 96px;

        margin-right: 126px;
    }

    #form-aside p {
        width: 403px;
        height: 154px;

        font-size: 20px;
        line-height: 112%;

        margin-right: 126px;
    }

    #form-aside h3 span, #form-aside p span {
        color: var(--p-cian);
    }
</style>

<style>
    #form-section {
        width: 50%;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    #form-section form {
        width: 460px;
        box-sizing: border-box;
        padding: 42px 65px;

        display: flex;
        flex-direction: column;
       
        border: 1px solid var(--border);
        border-radius: 10px;

        margin-left: 67px;
    }


    #form-logo {
        width: 100%;
        height: 29px;
        display: flex;
        justify-content: center;

        margin-bottom: 42px;
    }
    
    #form-logo img {
        width: 39px;
        height: 29px;
    }


    form input {
        display: block;
        width: 100%;
        height: 40px;
        box-sizing: border-box;
        padding: 0 12px;

        border: 1px solid var(--border);
        border-radius: 10px;

        margin-top: 4px;
        margin-bottom: 29px;
    }

    #form-error {
        color: #F40B0B;
        margin-bottom: 12px;
        visibility: hidden;
    }

    #form-error.show {
        visibility: visible;
    }

    button {
        width: 100%;
        height: 40px;
        box-sizing: border-box;

        font-size: 18px !important;

        display: flex;
        justify-content: center;
        align-items: center;

        background: var(--button);
        border-radius: 10px;
        border: none;
        outline: none;       
        
        transition: .15s all;
        cursor: pointer;
        color: #000000 !important;
    }
    
    @media (hover: hover) {
        button:hover {
            background: #000000;
            color: #FFFFFF !important;
        }
    }
    
    button:disabled {
        background: #d1aedf;
        color: #313131 !important;
        cursor: not-allowed;
    }
</style>

<style>
    #instruction-aside {
        width: 50%;
        display: flex;
        justify-content: flex-end;
        align-items: center;
    }

    #instruction-logo {
        width: 100%;
        height: 140px;
    }
    
    #instruction-logo img {
        width: 192px;
        height: 140px;
    }

    .instruction-aside__content {
        width: 330px;
        display: flex;
        flex-direction: column;
        gap: 38px;

        margin-right: 132px;
    }

    .instruction-aside__content h3 {
        width: 100%;
        height: 160px;
    }

    .instruction-aside__content h3 span {
        color: var(--p-cian);
    }

    .instruction-aside__content button {
        width: 300px;
        height: 40px;
    }

    #instruction-section {
        width: 50%;
        display: flex;
        align-items: center;
    }

    #instruction-section p {
        width: 403px;
        height: 418px;
        line-height: 112%;

        margin-left: 58px;
    }

    #instruction-section-phone {
        display: none;
    }
</style>

<style>
    #question-section {
        width: 729px; /* Максимальная длина поля с вопросом */
        height: 100%;

        margin: 0 auto; /* По центру */
    }

    .question__section-content h2 {
        width: 546px;

        margin: 133px auto 52px auto; /* По центру */
    }

    .question {
        width: 100%;
        height: 119px;
        box-sizing: border-box;
        padding: 25px 93px;
        display: flex;

        border: 2px solid var(--border);
        border-radius: 10px;

        cursor: pointer;
    }

    .question:not(:first-child) {
        margin-top: 38px;
    }


    /* Выбраный вопрос */
    .question__mark-wrapper {
        width: 60px; /* 32 + 28 */
        height: 100%;
        display: flex;
        align-items: center;
    }

    .question__mark {
        width: 32px;
        height: 32px;
        box-sizing: border-box;

        border-radius: 50%;
        border: 1px solid var(--p-cian);
    }

    .question__mark.checked {
        background-color: var(--p-cian);
    }


    .question__content {
        width: calc(100% - 60px);
    }

    /* .question__content .p1-strong {
        margin-bottom: 4px;
    } */

    #question-description-1, #question-description-2 {
        margin-top: 4px;
    }


    /* Кнопки под вопросом */
    .question-buttons {
        width: 622px;
        height: 86px;
        box-sizing: border-box;
        padding: 20px 52px;

        display: flex;
        justify-content: space-between;
        align-items: center;

        margin: 56px auto 0 auto;
    }


    .question-buttons button {
        width: 178px;
        height: 46px;
    }

    .question-buttons p, .question-buttons .p1 {
        font-size: 18px;
    }


    /* Контет вопроса с открытым ответом */
    .question-open__section-content h3 {
        width: 100%;
        margin-top: 129px;
    }

    .question-open__section-content h3 span {
        color: var(--p-cian);
    }

    .question-open__section-content textarea {
        width: 729px;
        height: 119px;
        box-sizing: border-box;
        padding: 12px 12px;
        resize: none;

        border: 2px solid var(--border);
        border-radius: 10px;

        margin-top: 40px;
        margin-bottom: -4px;
    }
</style>

<style>
    input[type="email"] {
        margin-bottom: 12px;
    }


    /* Обработка персональной информации */
    .form-checkbox {
        display: flex;
        align-items: flex-start;
        gap: 12px;

        margin-bottom: 20px;
    }

    #label-policy {
        width: calc(100% - 12px - 15px);
        font-size: 12px;
        line-height: 112%;
        cursor: pointer;
    }

    #label-policy span {
        font-size: 12px;
        line-height: 112%;
        cursor: pointer;
        display: inline;

        font-weight: 500;
        color: var(--h-title);
    }

    @media (hover: hover) {
        #label-policy span:hover {
            text-decoration: underline;
        }
    }

    @media (hover: none) {
        #label-policy span {
            text-decoration: underline;
        }
    }

    #policy {
        width: 15px;
        height: 15px;
        box-sizing: border-box;
        cursor: pointer;

        border-radius: 3px;
        border: 1px solid var(--border);
        background-color: #ffffff;

    }

    #policy.checked {
        background-color: var(--border);
    }
</style>

<article>
    <div id="top-left-logo">
        <img src="https://static.tildacdn.com/tild6630-3237-4638-a534-313664333931/___.svg" alt="logo">
    </div>
    
    <aside id="form-aside">
        <h3>После заполнения анкеты вам откроется доступ к тесту<br><span>«43 профессии»</span></h3>
        <p>Тест поможет узнать, какие виды деятельности вам подходят больше всего.<br>Пожалуйста, внимательно прочитайте инструкцию, прежде чем переходить к самому тесту. Инструкция будет доступна вам после заполнения данной формы.</p>
    </aside>

    <section id="form-section">
        <form>
            <div id="form-logo">
                <img src="https://sun9-33.userapi.com/impg/o7UasFLuPHffAw7M354dhIyAw-ywr1TdpgWp7w/AU35d9CQutY.jpg?size=192x140&quality=96&sign=65f29d920ee520f801e55492621ceaed&type=album" alt="mini-logo">
            </div>

            <label class="p1" for="form-name">ФИО</label>
            <input class="p1" type="text" id="form-name" name="form-name" maxlength="100" required>

            <label class="p1" for="form-phone">Телефон</label>
            <input class="p1" type="tel" id="form-phone" name="form-phone" maxlength="20" required>

            <label class="p1" for="form-email">Email</label>
            <input class="p1" type="email" id="form-email" name="form-email" maxlength="100" required>

            <p id="form-error">Неверный формат ФИО</p>

            <div class="form-checkbox">
                <div id="policy"></div>
                <label id="label-policy" for="policy" class="p1">Я принимаю условия <span>Пользовательского соглашения</span> и даю свое <span>согласие на обработку персональных данных</span> в соответствии с <span>Политикой</span>.</label>
            </div>
            

            <button class="p1" type="submit" id="submit-form">Далее</button>
        </form>
    </section>

    <!-- Инструкция -->
    <aside id="instruction-aside" class="hidden">
        <div class="instruction-aside__content">
            <div id="instruction-logo">
                <img src="https://sun9-33.userapi.com/impg/o7UasFLuPHffAw7M354dhIyAw-ywr1TdpgWp7w/AU35d9CQutY.jpg?size=192x140&quality=96&sign=65f29d920ee520f801e55492621ceaed&type=album" alt="instruction-logo">
            </div>
            <h3>В этом <span>тесте</span> вам будет предложено 43 раза сделать выбор. И каждый раз вы будете выбирать из двух профессий.</h3>
            <p id="instruction-section-phone" class="hidden">Пожалуйста, подойдите к выбору вдумчиво и осознанно. Не спешите и внимательно читайте описание каждой профессии.
            <br><br>
            Не думайте в этом тесте о деньгах. Выбирайте так, словно доход во всех предложенных профессиях будет одинаковым. Примеряйте на себя именно вид деятельности. Чем вам было бы интереснее заниматься?
            <br><br>
            Возможно, в каком-то из вариантов обе профессии вам не понравятся. Но и в этом случае необходимо сделать выбор в пользу чего-то одного. Пусть и по принципу "из двух зол меньшее".
            <br><br>
            Удачи!</p>
            <button class="p1" id="submit-instruction">Начать тестирование</button>
        </div>
    </aside>

    <section id="instruction-section" class="hidden">
        <p>Пожалуйста, подойдите к выбору вдумчиво и осознанно. Не спешите и внимательно читайте описание каждой профессии.
        <br><br>
        Не думайте в этом тесте о деньгах. Выбирайте так, словно доход во всех предложенных профессиях будет одинаковым. Примеряйте на себя именно вид деятельности. Чем вам было бы интереснее заниматься?
        <br><br>
        Возможно, в каком-то из вариантов обе профессии вам не понравятся. Но и в этом случае необходимо сделать выбор в пользу чего-то одного. Пусть и по принципу "из двух зол меньшее".
        <br><br>
        Удачи!</p>
    </section>

    <!-- Вопрос -->
    <section id="question-section" class="hidden">
        <!-- Обычный вопрос -->
        <div class="question__section-content">
            <h2>Мне больше подходит:</h2>

            <div class="question" id="question-1">
                <div class="question__mark-wrapper">
                    <div class="question__mark" id="question-mark-1"></div>
                </div>
                <div class="question__content">
                    <p class="p1-strong" id="question-title-1"></p>
                    <p id="question-description-1"></p>
                </div>
            </div>

            <div class="question" id="question-2">
                <div class="question__mark-wrapper">
                    <div class="question__mark" id="question-mark-2"></div>
                </div>
                <div class="question__content">
                    <p class="p1-strong" id="question-title-2"></p>
                    <p id="question-description-2"></p>
                </div>
            </div>
        </div>

        <!-- Вопрос с откртым ответом -->
        <div class="question-open__section-content hidden">
            <h3>Вы сейчас прочитали о <span>86 различных профессиях.</span> Запишите 3 профессии из изученных 86, которые, как вам кажется, могли бы вам подойти. Это должны быть три профессии, которые у вас во время чтения вызвали мысли в духе «вот этим мне было бы, наверное, интересно заниматься». Пусть это будут три профессии, которые вы бы рассматривали в первую очередь для себя, если бы в мире осталось всего 86 профессий:</h3>
            <textarea class="p1" id="question-open-input" maxlength="500"></textarea>
        </div>

        <div class="question-buttons">
            <button class="p1" id="button-prev">Назад</button>
            <p class="js-question-counter"></p> <!-- Класс вместо id что бы заменить текст в обеих -->
            <button class="p1" id="button-next">Далее</button>
            <button class="p1 hidden" id="button-end" disabled>Завершить</button>
        </div>
    </section>
</article>

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    // Пометить инпут ошибкой
    function inputError(selector) {
        // Если у инпута нету класса ошибки - добавляем и через 2 секунды удаляем
        if (!$(selector).hasClass("error")) {
            $(selector).addClass("error")
            setTimeout(() => {$(selector).removeClass("error")}, 2000)
        }
    }


    // Перавя буква заглавная
    function FirstUpperCase(str) {
        // Если есть хотябы один символ
        if (str.length !== 0) {
            return str[0].toUpperCase() + str.slice(1);
        }

        // Иначе пустая строка
        return ""
    }


    function renderQuestion() {
        // Рендер позицию в вопросах
        $(".js-question-counter").text(questionCounter + "/" + questions.length)

        if (questionCounter === 0) { // Если текущий вопрос 0 - это форма
            // Прячем вопросы и показываем начальную форму
            $("#form-aside").removeClass("hidden")
            $("#form-section").removeClass("hidden")
            $("#instruction-aside").addClass("hidden")
            $("#instruction-section").addClass("hidden")
            $("#instruction-section-phone").addClass("hidden")

            $("#question-section").addClass("hidden")
            return
        } else if (questionCounter === questions.length) { // Если текущий вопрос последний
            // Прячем обычный ответ и показывает открытый
            $("#form-aside").addClass("hidden")
            $("#form-section").addClass("hidden")
            $("#question-section").removeClass("hidden")
            $(".question__section-content").addClass("hidden")
            $(".question-open__section-content").removeClass("hidden")

            // Кнопка Далее заменятеся на Завершить
            $("#button-next").addClass("hidden")
            $("#button-end").removeClass("hidden")
            return
        }


        // Если обычный вопрос 
        // Прячем начальную форму и открытый ответ
        $("#form-aside").addClass("hidden")
        $("#form-section").addClass("hidden")
        $("#instruction-aside").addClass("hidden")
        $("#instruction-section").addClass("hidden")
        $("#instruction-section-phone").addClass("hidden")


        $("#question-section").removeClass("hidden")
        $(".question__section-content").removeClass("hidden")
        $(".question-open__section-content").addClass("hidden")

        // Кнопка Завершить заменятеся на Далее
        $("#button-next").removeClass("hidden")
        $("#button-end").addClass("hidden")

        $("#question-title-1").text(FirstUpperCase(questions[questionCounter].title1))
        $("#question-description-1").text(FirstUpperCase(questions[questionCounter].description1))
        $("#question-title-2").text(FirstUpperCase(questions[questionCounter].title2))
        $("#question-description-2").text(FirstUpperCase(questions[questionCounter].description2))

        // Отключаем кнопку далее
        $("#button-next").attr("disabled", "disabled")

        // Удаляем флажок
        $("#question-mark-1").removeClass("checked")
        $("#question-mark-2").removeClass("checked")

        // Если вес у первой кнопки, то ставим флажок первому вопросу и включаем кнопку далее
        if (questions[questionCounter].weight1) {
            $("#question-mark-1").addClass("checked")
            $("#button-next").removeAttr("disabled")
        }

        // Если вес у второй кнопки, то ставим флажок второму вопросу и включаем кнопку далее
        if (questions[questionCounter].weight2) {
            $("#question-mark-2").addClass("checked")
            $("#button-next").removeAttr("disabled")
        }
    }




    let questionCounter = 0 // Текущий вопрос

    // Если информация была взята из хэша, то перебираем пока не найдем последний отвеченый вопрос
    if (isQuestionsHash) {
        for (element of questions) {
            if (element.weight1 || element.weight2) {
                questionCounter = element.id + 1 // Записываем в текущий вопрос следущий вопрос после последнего ответа
            }
        }
        renderQuestion()
    }


    // Если пользователь валидно заполнил форму и данные сохранились в хэш, то заполняем поля
    let hashUserFormData = JSON.parse(localStorage.getItem("userFormData"))
    if (hashUserFormData) {
        $("#form-name").val(hashUserFormData.formName)
        $("#form-phone").val(hashUserFormData.formPhone)
        $("#form-email").val(hashUserFormData.formEmail)
    }


    // Кнопка назад
    $("#button-prev").on("click tap", () => {
        // Если вопрос больше нуля (1 - первый вопрос), то переход на нулевое поле - форма
        if (questionCounter > 0) {
            questionCounter--
            renderQuestion()
        }
    })

    // Кнопка вперед
    $("#button-next").on("click tap", () => {
        // Если вопрос не последний
        if (questionCounter < questions.length) {
            questionCounter++
            renderQuestion()
        }
    })


    // Кнопка первого варивнта ответа
    $("#question-1").on("click tap", () => {
        // Ставим вес ответа в первый и ставим флаг
        questions[questionCounter].weight1 = 1
        questions[questionCounter].weight2 = 0
        $("#question-mark-1").addClass("checked")
        $("#question-mark-2").removeClass("checked")

        $("#button-next").removeAttr("disabled")
        // $("#button-next").trigger("click") // Автопереключение вопроса при выборе ответа

        // Записываем ответы в хеш
        localStorage.setItem("questionsHash", JSON.stringify(questions))
    })

    // Кнопка второго варивнта ответа
    $("#question-2").on("click tap", () => {
        // Ставим вес ответа во втрой и ставим флаг
        questions[questionCounter].weight1 = 0
        questions[questionCounter].weight2 = 1
        $("#question-mark-1").removeClass("checked")
        $("#question-mark-2").addClass("checked")

        $("#button-next").removeAttr("disabled")
        // $("#button-next").trigger("click") // Автопереключение вопроса при выборе ответа

        // Записываем ответы в хеш
        localStorage.setItem("questionsHash", JSON.stringify(questions))
    })

    $("#form-name").change(() => { // Удаление лишних пробелов
        $("#form-name").val($("#form-name").val().replace(/ +/g, ' ').trim())
    })

    $("#form-phone").change(() => { // Удаление пробелов
        $("#form-phone").val($("#form-phone").val().replace(/ /g,''))
    })

    $("#form-email").change(() => { // Удаление пробелов
        $("#form-email").val($("#form-email").val().replace(/ /g,''))
    })


    // Ивент submit у формы фхода
    const form = document.querySelector('form')
    form.addEventListener('submit', (event) => {
        // Отключение базового перехода
        event.preventDefault()

        // Отсключаем кнопку на 2 секунды
        $("#submit-form").attr("disabled", "disabled")
        setTimeout(() => {
            $("#submit-form").removeAttr("disabled")
        }, 2000)


        // Получаем поля из фомы
        const formData = new FormData(form)
        const formName = formData.get("form-name")
        const formPhone = formData.get("form-phone")
        const formEmail = formData.get("form-email")
        
        // В поле ФИО должно быть ровно 3 слова
        if (formName.split(" ").length !== 3) {
            inputError("#form-name")

            // Ставим текст ошибки
            $("#form-error").text("Неверный формат ФИО")
            $("#form-error").addClass("show")
            setTimeout(() => {
                $("#form-error").removeClass("show")
            }, 2000)
            return
        }

        // Проверка поля Телефона на регулрном выражении
        let rePhone = /^[\d\+][\d\(\)\ -]{9,14}\d$/
        if (!rePhone.test(formPhone)) {
            inputError("#form-phone")
            // Ставим текст ошибки
            $("#form-error").text("Неверный номер телефона")
            $("#form-error").addClass("show")
            setTimeout(() => {
                $("#form-error").removeClass("show")
            }, 2000)
            return
        }

        // Проверка поля Почты на регулрном выражении
        let reEmail = /^[\w-\.]+@[\w-]+\.[a-z]{2,4}$/i
        if (!reEmail.test(formEmail)) {
            inputError("#form-email")
            // Ставим текст ошибки
            $("#form-error").text("Неверный email")
            $("#form-error").addClass("show")
            setTimeout(() => {
                $("#form-error").removeClass("show")
            }, 2000)
            return
        }

        if (!$("#policy").hasClass("checked")) {
            // Ставим текст ошибки
            $("#form-error").text("Отметьте поле")
            $("#form-error").addClass("show")
            setTimeout(() => {
                $("#form-error").removeClass("show")
            }, 2000)
            return
        }


        $("#form-aside").addClass("hidden")
        $("#form-section").addClass("hidden")
        $("#instruction-aside").removeClass("hidden")
        $("#instruction-section").removeClass("hidden")
        $("#instruction-section-phone").removeClass("hidden")

        $("#question-section").addClass("hidden")


        // Сохраняем информацию в хэш
        let userFormData = {
            formName: formName,
            formPhone: formPhone,
            formEmail: formEmail,
        }

        localStorage.setItem("userFormData", JSON.stringify(userFormData))

        // Когда заполнили все поля и нажали "Далее", то рендерит Правила
    })

    // Кпнока Начать тестирование в Правила
    $("#submit-instruction").on("click tap", () => {
        $("#form-aside").addClass("hidden")
        $("#form-section").addClass("hidden")
        $("#instruction-aside").addClass("hidden")
        $("#instruction-section").addClass("hidden")
        $("#instruction-section").addClass("hidden")
        $("#question-section").removeClass("hidden")

        questionCounter = 1
        renderQuestion()
    })


    // Включаем кнопку "Завершить" если написан открытый ответ
    $("#question-open-input").on("input", () => {
        if ($("#question-open-input").val() === "") {
            $("#button-end").attr("disabled", "disabled")
            return
        }

        $("#button-end").removeAttr("disabled")
    })


    // Кнопка завершить
    $("#button-end").on("click tap", () => {
        // Отсключаем кнопку на 5 секунды (Что бы повторно не нажали)
        $("#button-end").attr("disabled", "disabled")
        setTimeout(() => {
            $("#button-end").removeAttr("disabled")
        }, 5000)


        // Создаем массив содержащий все ответы
        let answ = {}
        for (let i = 1; i < questions.length; i++) {
            answ[i] = {
                id: i,
                weight1: questions[i].weight1,
                weight2: questions[i].weight2
            }
        }

        // Собираем вес средних результатов
        let realism = ((
            (answ[1].weight1 + answ[2].weight1 + answ[3].weight1 + answ[4].weight1 + answ[5].weight1) +
            (answ[16].weight1 + answ[17].weight1 + answ[18].weight1 + answ[19].weight1 + answ[20].weight1) +
            (answ[31].weight1 + answ[32].weight1 + answ[33].weight1 + answ[34].weight1 + answ[35].weight1)) / 15).toFixed(2)
        
        let intelligence = ((answ[1].weight2 +
            (answ[6].weight1 + answ[7].weight1 + answ[8].weight1 + answ[9].weight1) + answ[16].weight2 +
            (answ[21].weight1 + answ[22].weight1 + answ[23].weight1 + answ[24].weight1) + answ[31].weight2 +
            (answ[36].weight1 + answ[37].weight1 + answ[38].weight1 + answ[39].weight1)) / 15).toFixed(2)

        
        let sociality = ((answ[2].weight2 + answ[6].weight2 +
            (answ[10].weight1 + answ[11].weight1 + answ[12].weight1) + answ[17].weight2 + answ[21].weight2 +
            (answ[25].weight1 + answ[26].weight1 + answ[27].weight1) + answ[32].weight2 + answ[36].weight2 +
            (answ[40].weight1 + answ[41].weight1 + answ[42].weight1)) / 15).toFixed(2)
        
        let conventionality = ((
            answ[13].weight1 + answ[14].weight1 + answ[28].weight1 + answ[29].weight1 + answ[43].weight1 +
            answ[40].weight2 + answ[37].weight2 + answ[33].weight2 + answ[25].weight2 + answ[22].weight2 +
            answ[17].weight2 + answ[10].weight2 + answ[7].weight2 + answ[3].weight2) / 14).toFixed(2)
        
        let enterprise = ((
            answ[15].weight1 + answ[30].weight1 + answ[4].weight2 + answ[8].weight2 + answ[11].weight2 +
            answ[13].weight2 + answ[19].weight2 + answ[23].weight2 + answ[26].weight2 + answ[28].weight2 +
            answ[34].weight2 + answ[38].weight2 + answ[41].weight2 + answ[43].weight2) / 14).toFixed(2)

        let artistry = ((
            answ[5].weight2 + answ[9].weight2 + answ[12].weight2 + answ[14].weight2 + answ[15].weight2 +
            answ[20].weight2 + answ[24].weight2 + answ[27].weight2 + answ[29].weight2 + answ[30].weight2 +
            answ[35].weight2 + answ[39].weight2 + answ[42].weight2) / 13).toFixed(2)
        
        let allWeights = {
            realism: realism,
            intelligence: intelligence,
            sociality: sociality,
            conventionality: conventionality,
            enterprise: enterprise,
            artistry: artistry
        }


        // Получаем информацию о пользователе
        let userFormData = JSON.parse(localStorage.getItem("userFormData"))
        
        // Массив который отправиться
        let sendData = {
        // id: Установиться в google scripts
            "manager-id": URLParams["manager-id"],
            "name": userFormData.formName,
            "phone": userFormData.formPhone,
            "email": userFormData.formEmail,
            "new": true,
            "result": {
                "diagnostic-id": 0, // Для этой диагностики id = 0
                "weights": allWeights,
                "openAnswer": $("#question-open-input").val(),
                "answers": answ,
                "date": Date.now() // Дата текущего прохождения
            },
            "in-archive": false,
            "date": Date.now() // Дата последней активности
        }
        
        // Api запрос в таблицу с результатами
        function GSapiDiagnostics(data, func) {
            // Ссылка на скрипт Google API (Diagnostics)
            const GoogleSheetURL = "https://script.google.com/macros/s/AKfycbwXdjo--XuEh6WHbWWIqNca7LzdKB5QID124KOrXJ-5Hu74MShztd2RN-tAh6sEMpPT/exec"
            $.ajax({
                crossDomain: true,
                url: GoogleSheetURL + "?action=addResults",
                method: "GET",
                dataType: 'JSONP',
                data: data,
                success: func
            })
        }

        GSapiDiagnostics({data: JSON.stringify(sendData)}, (data) => {
            // Информация отправляется и перекидывает на конец тестирования

            // Добавляем значение в хэш что бы после перезагрузки перекинуло на концовку
            localStorage.setItem("test-end", "test-end")
            location.reload()
        })
    })



    // Галочка 
    $("#policy").on("click tap", () => {
        $("#policy").toggleClass("checked")
    })

    // Клик тексту после галочки
    $("#label-policy").on("click tap", () => {
        $("#policy").toggleClass("checked")
    })

    // Клик по политике
    $("#label-policy span").on("click tap", () => {
        window.open("../policy", "_blank")
    })
</script>